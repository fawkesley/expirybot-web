{% extends 'expirybot/base.html' %}
{% load widget_tweaks %}

{% block title_inner %}Monitor your email address in the PGP keyservers{% endblock %}

{% block content %}

  <div id="login" class="container">

    {% if login_partial %}

      {% include login_partial %}

    {% else %}

      <h1>Log in</h1>

    {% endif %}

    <form class="form-horizontal" method="post">
      {% csrf_token %}

      {{ form.non_field_errors }}

      {% with form.email_address as field %}

	<div class="form-group {% if field.errors %}has-error{% endif %}">
	  <label for="{{ field.id_for_label }}" class="col-sm-2 control-label">{{ field.label }}</label>
	  <div class="col-sm-10">
            {{ field|add_class:"form-control"|attr:"placeholder:e.g. your.name@example.com"|attr:"autofocus" }}
            <span class="help-block text-left">
              {{ field.errors }}
            </span>
	  </div>

	</div>

	<div class="form-group">
	  <div class="col-sm-offset-2 col-sm-10">
	    <button type="submit" class="btn btn-default">Login</button>
	  </div>
	</div>
      {% endwith %}
    </form>

  </div>

  <script>
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function ready(fn) {
      if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading"){
        fn();
      } else {
        document.addEventListener('DOMContentLoaded', fn);
      }
    }

    function fillInputFromQueryParameter() {
      var input = document.getElementById('id_email_address'),
          email = getParameterByName('email');

      if(!!input && !!email) {
        input.value = email;
      }
    }

    ready(fillInputFromQueryParameter);

  </script>


{% endblock %}
